# Video Manager

一个用于在多个移动硬盘上快速查找和管理视频文件的桌面应用程序。

## 功能特性

### 核心功能
- **视频文件索引**: 快速扫描和索引多个移动硬盘上的视频文件
- **目录级扫描**: 支持右键菜单快速扫描指定目录，显示详细统计信息（扫描文件数、新增数、删除数、耗时）
- **跨磁盘搜索**: 支持在多个磁盘间统一搜索视频，支持实时搜索（可选）
- **SQLite 数据库**: 每个磁盘拥有独立的索引文件，基于相对路径实现磁盘索引的可移植性

### 界面功能
- **图形化界面**: 提供树形视图和表格视图，方便浏览和管理视频文件
- **主题切换**: 支持浅色/深色/跟随系统三种主题，配置持久化保存
- **快捷键支持**:
  - `Ctrl + F`: 聚焦搜索框
  - `Alt + W`: 清空搜索内容
- **实时搜索**: 可选的实时搜索功能，输入时自动触发搜索（700ms 延迟）
- **智能文件树**: 刷新后自动恢复选中状态，提升用户体验

### 文件操作
- **打开所在文件夹**: 右键菜单支持在资源管理器中打开并选中文件
- **SMART 信息检测**: 可选功能，支持检测磁盘健康状态
- **中文支持**: 支持中文文件名和简体中文界面，自动进行简繁体转换

## 系统要求

- Java 21 或更高版本
- Windows 操作系统
- 64 位 JDK/JRE

## 使用方法

### 基本使用

1. **创建索引标记文件**

   将 `.disk.needindex` 文件复制到需要索引的分区根目录，或者在该目录下创建一个名为 `.disk.needindex` 的空文件。

2. **运行程序**

   ```bash
   java -jar video-manager-0.0.1-SNAPSHOT-shaded.jar
   ```

   或直接运行编译后的可执行文件：
   ```bash
   video-manager.exe
   ```

3. **程序将自动**
   - 检测带有 `.disk.needindex` 标记的磁盘
   - 扫描并索引视频文件
   - 在界面上显示文件树和搜索功能

### 搜索功能

#### 快捷键
- **Ctrl + F**: 快速聚焦到搜索框
- **Alt + W**: 清空搜索内容

#### 实时搜索
- 勾选搜索框旁的"实时搜索"复选框
- 输入时自动触发搜索（700ms 延迟，避免频繁查询）
- 取消勾选则需要按回车键或点击搜索按钮执行搜索

### 目录级扫描

在文件列表中右键点击任意文件或目录，选择"扫描此目录"功能：

- **智能识别**：自动识别选中项是文件还是目录，目录则扫描自身，文件则扫描其父目录
- **进度显示**：弹出进度窗口，实时显示扫描进度
- **详细统计**：扫描完成后显示：
  - 扫描文件总数
  - 新增文件数
  - 删除旧记录数
  - 扫描耗时
- **增量更新**：先删除该目录的旧索引记录，再插入新的扫描结果

### SMART 信息检测（可选）

如需启用磁盘健康状态检测：

1. 从 [smartmontools 官网](https://www.smartmontools.org) 下载 smartmontools
2. 将 `smartctl` 可执行文件复制到 Windows 的 `system32` 目录下
3. 对于非移动硬盘，SMART 检测可能需要管理员权限，可以以管理员身份运行 video-manager

### 主题切换

程序支持三种主题模式，可通过菜单栏切换：

- **浅色主题**: 适合白天使用，色彩明亮
- **深色主题**: 适合夜间使用，保护视力
- **跟随系统**: 自动根据系统主题切换

主题配置保存在 `~/.video-manager/theme.properties`，下次启动时自动应用上次选择的主题。

## 编译打包

项目使用 Maven 进行构建管理，执行以下命令：

```bash
mvn clean package
```

编译成功后，将在 `target` 目录下生成：
- `video-manager-0.0.1-SNAPSHOT-shaded.jar` - 包含所有依赖的可执行 JAR 文件
- `video-manager.exe` - Windows 可执行文件

## 技术栈

- **Java**: 17
- **构建工具**: Maven
- **数据库**: SQLite (sqlite-jdbc 3.51.1.0)
- **GUI 框架**: Java Swing + FlatLaf（现代化主题）
- **中文转换**: OpenCC4j 1.14.0
- **日志**: SLF4J + Logback
- **工具库**: Apache Commons Lang3, Apache Commons IO

## 项目结构

```
src/
├── main/
│   ├── java/com/github/scm1219/
│   │   ├── utils/           # 工具类
│   │   ├── video/
│   │   │   ├── domain/      # 领域模型
│   │   │   ├── gui/         # 图形界面
│   │   │   └── VideoManagerApp.java  # 主程序入口
│   └── resources/           # 资源文件
└── test/                    # 测试代码
```

## 更新日志

### 2026-01-29
- ✨ 新增实时搜索功能
  - 添加"实时搜索"复选框，启用后输入时自动触发搜索
  - 700ms 延迟机制，避免频繁查询影响性能
- ⌨️ UI 优化，添加快捷键支持
  - `Ctrl + F`: 快速聚焦搜索框
  - `Alt + W`: 清空搜索内容
- 🐛 处理打包警告，优化构建配置

### 2026-01-28
- 🎨 新增主题功能
  - 支持浅色/深色/跟随系统三种主题
  - 主题配置持久化保存（`~/.video-manager/theme.properties`）
  - 菜单栏切换主题，下次启动自动应用
- 🔧 优化文件树用户交互体验
  - 刷新后自动恢复选中状态
  - 优化树节点渲染器，使用 JPanel + JLabel 替代 HTML 标签
  - 提取颜色常量，提高性能

### 2026-01-27
- ✨ 新增"打开所在文件夹"功能
  - 右键菜单支持在资源管理器中打开并选中文件
- ✨ 新增"扫描此目录"功能
  - 支持右键菜单快速扫描指定目录
  - 显示详细统计信息（扫描文件数、新增数、删除数、耗时）
  - 智能识别文件/目录，自动确定扫描范围
  - 增量更新索引，先删除旧记录再插入新记录
- 🐛 修复文件大小排序错误的问题
- 🌳 修改左侧树状显示逻辑，优化节点展开行为
- ⚡ 性能优化：添加图标缓存和异步加载

## 许可证

Copyright 2022 springtour.cn
